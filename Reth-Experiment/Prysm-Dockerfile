FROM gcr.io/prysmaticlabs/prysm/beacon-chain:stable

# Set working directory
WORKDIR /app

# Create data directory
RUN mkdir -p /data/prysm

# Expose ports
# 4000 - Beacon API (gRPC)
# 13000 - P2P TCP
# 12000 - P2P UDP
# 8080 - Monitoring/metrics
EXPOSE 4000 13000/tcp 12000/udp 8080

# Set data directory environment variable
ENV PRYSM_DATADIR=/data/prysm

# Default command for mainnet with RPC access
# --mainnet: Run on Ethereum mainnet
# --datadir: Data directory for blockchain data
# --jwt-secret: Path to JWT secret file (Reth auto-generates this at /data/reth/jwt.hex)
# --execution-endpoint: Reth Engine API endpoint
#   NOTE: "reth" hostname requires both containers on same Docker network
#   and Reth container named "reth". Adjust if using different setup.
# --rpc-host: RPC host address
# --rpc-port: RPC port
# --http-host: HTTP host address
# --monitoring-host: Monitoring host address
# --accept-terms-of-use: Accept terms of use
# Logging: Handled by Docker's logging driver (configured in docker-compose.yml)
CMD ["--mainnet", \
     "--datadir=/data/prysm", \
     "--jwt-secret=/data/reth/jwt.hex", \
     "--execution-endpoint=http://reth:8551", \
     "--rpc-host=0.0.0.0", \
     "--rpc-port=4000", \
     "--http-host=0.0.0.0", \
     "--monitoring-host=0.0.0.0", \
     "--accept-terms-of-use"]

